<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Data.Vector.Map</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Data-Vector-Map.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Data-Vector-Map.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">structures-0.1: &quot;Advanced&quot; Data Structures</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Portability</th><td>non-portable</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Maintainer</th><td>Edward Kmett &lt;ekmett@gmail.com&gt;</td></tr><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Data.Vector.Map</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Rebuild
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides a <code>Vector</code>-based <code><a href="Data-Vector-Map.html#t:Map">Map</a></code> that is loosely based on the
 Cache Oblivious Lookahead Array (COLA) by Bender et al. from
 <a href="http://supertech.csail.mit.edu/papers/sbtree.pdf">&quot;Cache-Oblivious Streaming B-Trees&quot;</a>.
</p><p>Currently this <code><a href="Data-Vector-Map.html#t:Map">Map</a></code> is implemented in an insert-only fashion. Deletions are left to future work
 or to another derived structure in case they prove expensive.
</p><p>Unlike the COLA, this version merely provides amortized complexity bounds as this permits us to
 provide a fully functional API. However, even those asymptotics are only guaranteed if you do not
 modify the &quot;old&quot; versions of the <code><a href="Data-Vector-Map.html#t:Map">Map</a></code>. If you do, then while correctness is preserved, the
 asymptotic analysis becomes inaccurate.
</p><p>Reading from &quot;old&quot; versions of the <code><a href="Data-Vector-Map.html#t:Map">Map</a></code> does not affect the asymptotic analysis and is fine.
</p><p>Fractional cascading was originally replaced with the use of a hierarchical bloom filter per level containing
 the elements for that level, with the false positive rate tuned to balance the lookup cost against
 the costs of the cache misses for a false positive at that depth. This avoids the need to collect
 forwarding pointers from the next level, reducing pressure on the cache dramatically, while providing
 the same asymptotic complexity.
</p><p>With either of these two techniques when used ephemerally, this <code><a href="Data-Vector-Map.html#t:Map">Map</a></code> had asymptotic performance equal to that
 of a B-Tree tuned to the parameters of your caches with requiring such parameter tuning.
</p><p>However, the constants were still bad enough that the naive <em>O(log^2 n)</em> version of the COLA actually wins
 at lookups in benchmarks at the scale this data structure is interesting, say around a few million entries,
 by a factor of 10x! Consequently, we're currently not even Bloom filtering.
</p><p>Compared to the venerable <code>Data.Map</code>, this data structure currently consumes more memory, but it
 provides a more limited palette of operations with different asymptotics (~10x faster inserts at a million entries)
 and enables us to utilize contiguous storage.
</p><p><em>NB:</em> when used with boxed data this structure may hold onto references to old versions
 of things for many updates to come until sufficient operations have happened to merge them out
 of the COLA.
</p><p>TODO: track actual percentage of occupancy for each vector compared to the source vector it was based on.
 This would permit <code><a href="Data-Vector-Map.html#v:split">split</a></code> and other operations that trim a <code><a href="Data-Vector-Map.html#t:Map">Map</a></code> to properly reason about space usage by
 borrowing the 1/3rd occupancy rule from a Stratified Doubling Array.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:Map">Map</a> k v<ul class="subs"><li>= <a href="#v:Nil">Nil</a>  </li><li>| <a href="#v:One">One</a> !k v !(<a href="Data-Vector-Map.html#t:Map">Map</a> k v)  </li><li>| <a href="#v:Map">Map</a> !<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> !(<a href="Data-Vector-Array.html#t:Array">Array</a> k) !(<a href="Data-Vector-Array.html#t:Array">Array</a> v) !(<a href="Data-Vector-Map.html#t:Map">Map</a> k v)  </li></ul></li><li class="src short"><a href="#v:empty">empty</a> ::  <a href="Data-Vector-Map.html#t:Map">Map</a> k v</li><li class="src short"><a href="#v:null">null</a> ::  <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:singleton">singleton</a> :: <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v =&gt; k -&gt; v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v</li><li class="src short"><a href="#v:lookup">lookup</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; k -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> v</li><li class="src short"><a href="#v:insert">insert</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; k -&gt; v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v</li><li class="src short"><a href="#v:insert4">insert4</a> :: <span class="keyword">forall</span> k v. (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; k -&gt; v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v</li><li class="src short"><a href="#v:fromDistinctAscList">fromDistinctAscList</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; [(k, v)] -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v</li><li class="src short"><a href="#v:fromList">fromList</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; [(k, v)] -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v</li><li class="src short"><a href="#v:shape">shape</a> ::  <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; [<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a>]</li><li class="src short"><a href="#v:split">split</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; k -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; (<a href="Data-Vector-Map.html#t:Map">Map</a> k v, <a href="Data-Vector-Map.html#t:Map">Map</a> k v)</li><li class="src short"><a href="#v:union">union</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v</li><li class="src short"><a href="#v:rebuild">rebuild</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Map" class="def">Map</a> k v <a href="src/Data-Vector-Map.html#Map" class="link">Source</a></p><div class="doc"><p>This Map is implemented as an insert-only Cache Oblivious Lookahead Array (COLA) with amortized complexity bounds
 that are equal to those of a B-Tree when it is used ephemerally, using Bloom filters to replace the fractional
 cascade.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Nil" class="def">Nil</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:One" class="def">One</a> !k v !(<a href="Data-Vector-Map.html#t:Map">Map</a> k v)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:Map" class="def">Map</a> !<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> !(<a href="Data-Vector-Array.html#t:Array">Array</a> k) !(<a href="Data-Vector-Array.html#t:Array">Array</a> v) !(<a href="Data-Vector-Map.html#t:Map">Map</a> k v)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:Map" class="caption collapser" onclick="toggleSection('i:Map')">Instances</p><div id="section.i:Map" class="show"><table><tr><td class="src">(<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Read.html#t:Read">Read</a> (<a href="Data-Vector-Array.html#t:Arr">Arr</a> v v), <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Read.html#t:Read">Read</a> (<a href="Data-Vector-Array.html#t:Arr">Arr</a> k k), <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Read.html#t:Read">Read</a> k, <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Read.html#t:Read">Read</a> v) =&gt; <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Read.html#t:Read">Read</a> (<a href="Data-Vector-Map.html#t:Map">Map</a> k v)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> (<a href="Data-Vector-Array.html#t:Arr">Arr</a> v v), <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> (<a href="Data-Vector-Array.html#t:Arr">Arr</a> k k), <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> k, <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> v) =&gt; <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> (<a href="Data-Vector-Map.html#t:Map">Map</a> k v)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:empty" class="def">empty</a> ::  <a href="Data-Vector-Map.html#t:Map">Map</a> k v<a href="src/Data-Vector-Map.html#empty" class="link">Source</a></p><div class="doc"><p><em>O(1)</em> The <code><a href="Data-Vector-Map.html#v:empty">empty</a></code> <code><a href="Data-Vector-Map.html#t:Map">Map</a></code>.
</p></div></div><div class="top"><p class="src"><a name="v:null" class="def">null</a> ::  <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Bool.html#t:Bool">Bool</a><a href="src/Data-Vector-Map.html#null" class="link">Source</a></p><div class="doc"><p><em>O(1)</em>. Identify if a <code><a href="Data-Vector-Map.html#t:Map">Map</a></code> is the <code><a href="Data-Vector-Map.html#v:empty">empty</a></code> <code><a href="Data-Vector-Map.html#t:Map">Map</a></code>.
</p></div></div><div class="top"><p class="src"><a name="v:singleton" class="def">singleton</a> :: <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v =&gt; k -&gt; v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v<a href="src/Data-Vector-Map.html#singleton" class="link">Source</a></p><div class="doc"><p><em>O(1)</em> Construct a <code><a href="Data-Vector-Map.html#t:Map">Map</a></code> from a single key/value pair.
</p></div></div><div class="top"><p class="src"><a name="v:lookup" class="def">lookup</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; k -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> v<a href="src/Data-Vector-Map.html#lookup" class="link">Source</a></p><div class="doc"><p><em>O(log^2 N)</em> persistently amortized, <em>O(N)</em> worst case. Lookup an element.
</p></div></div><div class="top"><p class="src"><a name="v:insert" class="def">insert</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; k -&gt; v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v<a href="src/Data-Vector-Map.html#insert" class="link">Source</a></p><div class="doc"><p>O((log N)/B) ephemerally amortized loads for each cache, O(N/B) worst case. Insert an element.
</p></div></div><div class="top"><p class="src"><a name="v:insert4" class="def">insert4</a> :: <span class="keyword">forall</span> k v. (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; k -&gt; v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v<a href="src/Data-Vector-Map.html#insert4" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:fromDistinctAscList" class="def">fromDistinctAscList</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; [(k, v)] -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v<a href="src/Data-Vector-Map.html#fromDistinctAscList" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:fromList" class="def">fromList</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; [(k, v)] -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v<a href="src/Data-Vector-Map.html#fromList" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:shape" class="def">shape</a> ::  <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; [<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a>]<a href="src/Data-Vector-Map.html#shape" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:split" class="def">split</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; k -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; (<a href="Data-Vector-Map.html#t:Map">Map</a> k v, <a href="Data-Vector-Map.html#t:Map">Map</a> k v)<a href="src/Data-Vector-Map.html#split" class="link">Source</a></p><div class="doc"><p>Generates two legal maps from a source <code><a href="Data-Vector-Map.html#t:Map">Map</a></code>. The asymptotic analysis is preserved if only one of these is updated.
</p></div></div><div class="top"><p class="src"><a name="v:union" class="def">union</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v<a href="src/Data-Vector-Map.html#union" class="link">Source</a></p></div><h1 id="g:1">Rebuild
</h1><div class="top"><p class="src"><a name="v:rebuild" class="def">rebuild</a> :: (<a href="/usr/local/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> k, <a href="Data-Vector-Array.html#t:Arrayed">Arrayed</a> v) =&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v -&gt; <a href="Data-Vector-Map.html#t:Map">Map</a> k v<a href="src/Data-Vector-Map.html#rebuild" class="link">Source</a></p><div class="doc"><p>If using have trashed our size invariants we can use this to restore them
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.13.2</p></div></body></html>